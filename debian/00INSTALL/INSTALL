INSTALL
Created Thu Mar 15 12:29:37 AKDT 2018
Copyright (C) 2018 by Raymond E. Marcil <marcilr@gmail.com>


Installation of Docker for Debian

(installed on covellite - March 15, 2018)

0. Remove prior test installation of Docker CE:
  $ sudo aptitude remove docker-ce
  $ sudo aptitude remove docker-compose
  $ sudo aptitude remove python-docker
  $ sudo aptitude remove python-dockerpty

1. Prerequisites [1]
64-bit Debian or Raspbian versions:
o Buster 10 (Docker CE 17.11 Edge only)
o Stretch 9 (stable) / Raspbian Stretch   <=== Running Stretch 9.4 amd64
o Jessie 8 (LTS) / Raspbian Jessie
o Wheezy 7.7 (LTS)

Docker CE is supported on both x86_64 (or amd64)
and armhf architectures for Jessie and Stretch.

2. Linux kernel 3.10 or higher:[3]
$ uname -r
4.9.0-4-amd64
$

3. Uninstall old versions:[1]
sudo aptitude remove docker docker-engine docker.io

None of these packages were installed.

4. Add Docker CD repository:[2]
i. Update debian:
   $ sudo aptitude update
   $ sudo aptitude upgrade

ii. Added packages:
   $ sudo aptitude install apt-transport-https
   $ sudo aptitude install ca-certificates
   $ sudo aptitude install curl
   $ sudo aptitude install gnupg2
   $sudo aptitude install software-properties-common

   All packages installed already

iii. Add Dockerâ€™s official GPG key:
  $ curl -fsSL https://download.docker.com/linux/debian/gpg | \
  sudo apt-key add -
  OK
  $

iv. Verify that you now have the key with the fingerprint
  9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88,
  by searching for the last 8 characters of the fingerprint:

  $ sudo apt-key fingerprint 0EBFCD88
  pub   rsa4096 2017-02-22 [SCEA]
        9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
  uid           [ unknown] Docker Release (CE deb) <docker@docker.com>
  sub   rsa4096 2017-02-22 [S]

  $

  Looks good

v. Use the following command to set up the stable repository.
  You always need the stable repository, even if you want to
  install builds from the edge or test repositories as well.
  To add the edge or test repository, add the word edge or
  test (or both) after the word stable in the commands below.

  Note: The lsb_release -cs sub-command below returns the
        name of your Debian distribution, such as jessie.

  To also add the edge repository, add edge after stable on
  the last line of the command.

  $ sudo add-apt-repository \
  > "deb [arch=amd64] https://download.docker.com/linux/debian \
  > $(lsb_release -cs) \
  > stable"
  [sudo] password for marcilr: 
  $ 

  $ grep docker /etc/apt/sources.list
  deb [arch=amd64] https://download.docker.com/linux/debian stretch stable
  $

  Looks good

vi. Update now the docker repository has been configured:
  $ sudo aptutude update 
  ...
  Err https://download.docker.com/linux/debian stretch Release
  gnutls_handshake() failed: Public key signature verification has failed.
  ...
  E: The repository 'https://download.docker.com/linux/debian stretch Release'
  does not have a Release file.
  ...
  $

  Googling it looks like this error relates to the libcurl3-gnutls version.
  Apparently downgrading libcurl3 resolves the issue:

  Current new broken version:
    $ apt-cache showpkg libcurl3-gnutls
    Package: libcurl3-gnutls
    Versions: 
    7.52.1-5+deb9u4 (/var/lib/apt/lists/ftp.us.debian.org_\
    debian_dists_stable_main_binary-amd64_Packages) \
    (/var/lib/dpkg/status)
    ...
    $

  Install working older version:
    $ sudo aptitude install libcurl3-gnutls=7.38.0-4+deb8u4
    Unable to find a version "7.38.0-4+deb8u4" for the package "libcurl3-gnutls"
    Unable to apply some actions, aborting
    $

  The above failed so downloaded libcurl3-gnutls_7.38.0-4+deb8u10_amd64.deb from:
  http://security.debian.org/debian-security/pool/updates/main/c/curl/libcurl3-gnutls_7.38.0-4+deb8u10_amd64.deb

  Install libcurl3-gnutls_7.38.0-4+deb8u10_amd64.deb:
  $ sudo dpkg -i libcurl3-gnutls_7.38.0-4+deb8u10_amd64.deb[sudo] password for marcilr: 
  dpkg: warning: downgrading libcurl3-gnutls:amd64 from 7.52.1-5+deb9u4 to 7.38.0-4+deb8u10
  (Reading database ... 364759 files and directories currently installed.)
  Preparing to unpack libcurl3-gnutls_7.38.0-4+deb8u10_amd64.deb ...
  Unpacking libcurl3-gnutls:amd64 (7.38.0-4+deb8u10) over (7.52.1-5+deb9u4) ...
  Setting up libcurl3-gnutls:amd64 (7.38.0-4+deb8u10) ...
  Processing triggers for libc-bin (2.24-11+deb9u3) ...
  $

  Verify old libcurl3-gnutls installed:
  $ dpkg -l | grep libcurl3-gnutls
  ii  libcurl3-gnutls:amd64   7.38.0-4+deb8u10   amd64   \
  easy-to-use client-side URL transfer library (GnuTLS flavour)
  $ 

  Prior, working, libcurl3-gnutls looks good.

  Update with docker repository configure:
  $ sudo aptutude update
  Ign http://dl.google.com/linux/chrome/deb stable InRelease
  Hit http://download.virtualbox.org/virtualbox/debian stretch InRelease
  Ign http://ftp.us.debian.org/debian stable InRelease
  Hit http://dl.google.com/linux/chrome/deb stable Release
  Hit http://ftp.us.debian.org/debian stable Release
  Get: 1 https://download.docker.com/linux/debian stretch InRelease [39.1 kB]
  Get: 2 https://download.docker.com/linux/debian stretch/stable amd64 Packages [3,271 B]
  Fetched 42.4 kB in 0s (56.3 kB/s)     
                                         
  Current status: 41476 (+1) new.
  $ 

  This now works that


Filelist
========
libcurl3-gnutls_7.38.0-4+deb8u10_amd64.deb
  Download Page for libcurl3-gnutls_7.38.0-4+deb8u10_amd64.deb on AMD64 machines
  The latest libcurl3-gnutls 7.52.1-5+deb9u4 throws error:
    gnutls_handshake() failed: Public key signature verification has failed.
  https://packages.debian.org/jessie/amd64/libcurl3-gnutls/download
  http://security.debian.org/debian-security/pool/updates/main/c/curl/libcurl3-gnutls_7.38.0-4+deb8u10_amd64.deb


Links
=====
[1] Get Docker CE for Debian
Installation instructions
NOTE: This page has the bulk of the instructions used here
https://docs.docker.com/install/linux/docker-ce/debian/

[2] Set up the repository
https://docs.docker.com/install/linux/docker-ce/debian/#install-using-the-repository

[3] Setup instructions
Get Docker CE on Debian
Docker Community Edition for Debian
https://store.docker.com/editions/community/docker-ce-server-debian/plans/docker-ce-server-debian-tier?tab=instructions

Download Page for libcurl3-gnutls_7.38.0-4+deb8u10_amd64.deb on AMD64 machines
The latest libcurl3-gnutls 7.52.1-5+deb9u4 throws error:
  gnutls_handshake() failed: Public key signature verification has failed.
http://security.debian.org/debian-security/pool/updates/main/c/curl/libcurl3-gnutls_7.38.0-4+deb8u10_amd64.deb
https://packages.debian.org/jessie/amd64/libcurl3-gnutls/download
